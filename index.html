<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Farming CBA Decision Aid Tool - Newcastle Business School</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body data-theme="worldbank-light">
  <div id="toast-root"></div>

  <header class="app-header">
    <div class="brand">
      <div class="brand-mark">NBS</div>
      <div class="brand-text">
        <div class="brand-title">Farming CBA Decision Aid Tool</div>
        <div class="brand-subtitle">Newcastle Business School</div>
      </div>
    </div>
    <div class="header-actions">
      <button id="startBtn" class="btn primary">Start with project setup</button>
      <button id="saveProject" class="btn ghost">Save project (JSON)</button>
      <button id="loadProject" class="btn ghost">Load project</button>
      <input type="file" id="loadFile" accept=".json" style="display:none" />
    </div>
  </header>

  <main class="app-main">
    <nav class="tabs-nav" aria-label="Main sections">
      <button type="button" class="tab-link active" data-tab="intro" aria-selected="true">Introduction</button>
      <button type="button" class="tab-link" data-tab="project">Project</button>
      <button type="button" class="tab-link" data-tab="settings">Time and risk settings</button>
      <button type="button" class="tab-link" data-tab="outputs">Outputs</button>
      <button type="button" class="tab-link" data-tab="treatments">Treatments</button>
      <button type="button" class="tab-link" data-tab="benefits">Additional benefits</button>
      <button type="button" class="tab-link" data-tab="costs">Other costs</button>
      <button type="button" class="tab-link" data-tab="database">Sources</button>
      <button type="button" class="tab-link" data-tab="results">Results</button>
      <button type="button" class="tab-link" data-tab="simulation">Simulation</button>
      <button type="button" class="tab-link" data-tab="excel">Excel import and export</button>
      <button type="button" class="tab-link" data-tab="copilot">Policy brief helper</button>
    </nav>

<!-- INTRO TAB -->
<section class="tab-panel active show" id="tab-intro" data-tab-panel="intro" aria-hidden="false">
  <div class="card">
    <h1>Farming cost benefit analysis tool</h1>
    <p>
      This tool summarises the costs and benefits of farm treatments over a chosen analysis
      period. It is designed for applied farm trials and for rapid assessment of alternative
      strategies.
    </p>
    <p>
      The default dataset is based on a faba bean soil amendment trial. You can keep this as
      an example or replace it with your own data using the Excel tab.
    </p>
    <p>
      Use the tabs to move from project description, through outputs and treatments, to
      additional benefits, costs, and risk settings. The Results and Simulation tabs provide
      economic indicators and uncertainty analysis.
    </p>
    <div class="intro-actions">
      <button id="startBtn-duplicate" class="btn primary" data-tab-jump="project">
        Go to project setup
      </button>
      <button class="btn" data-tab-jump="outputs">Jump to outputs</button>
      <button class="btn" data-tab-jump="results">Jump to results</button>
    </div>
  </div>
</section>

<!-- PROJECT TAB -->
<section class="tab-panel" id="tab-project" data-tab-panel="project" aria-hidden="true">
  <div class="card">
    <h2>Project description</h2>
    <div class="row-3">
      <div class="field">
        <label for="projectName" data-tooltip="Short title for the farm trial or investment project.">
          Project name
        </label>
        <input id="projectName" type="text" />
      </div>
      <div class="field">
        <label for="projectLead" data-tooltip="Person with overall responsibility for the project.">
          Project lead
        </label>
        <input id="projectLead" type="text" />
      </div>
      <div class="field">
        <label for="analystNames" data-tooltip="People who prepared the cost benefit analysis.">
          Analyst team
        </label>
        <input id="analystNames" type="text" />
      </div>
    </div>

    <div class="row-3">
      <div class="field">
        <label for="projectTeam" data-tooltip="Delivery partners or trial team involved in implementation.">
          Partners or trial team
        </label>
        <input id="projectTeam" type="text" />
      </div>
      <div class="field">
        <label for="organisation" data-tooltip="Host organisation for the analysis or project.">
          Organisation
        </label>
        <input id="organisation" type="text" />
      </div>
      <div class="field">
        <label for="lastUpdated" data-tooltip="Date when the analysis was last updated.">
          Last updated
        </label>
        <input id="lastUpdated" type="date" />
      </div>
    </div>

    <div class="row-3">
      <div class="field">
        <label for="contactEmail" data-tooltip="Contact email for questions about the analysis.">
          Contact email
        </label>
        <input id="contactEmail" type="email" />
      </div>
      <div class="field">
        <label for="contactPhone" data-tooltip="Optional phone contact for follow up.">
          Contact phone
        </label>
        <input id="contactPhone" type="tel" />
      </div>
      <div class="field"></div>
    </div>

    <div class="field">
      <label for="projectSummary" data-tooltip="Short plain language description of the project and trial.">
        Short summary
      </label>
      <textarea id="projectSummary" rows="3"></textarea>
    </div>

    <div class="field">
      <label for="projectGoal" data-tooltip="Main goal in terms of production, profit, or risk reduction.">
        Project goal
      </label>
      <textarea id="projectGoal" rows="2"></textarea>
    </div>

    <div class="row-2">
      <div class="field">
        <label for="withProject" data-tooltip="What happens with the treatments or program in place.">
          With project (change story)
        </label>
        <textarea id="withProject" rows="3"></textarea>
      </div>
      <div class="field">
        <label for="withoutProject" data-tooltip="What happens under business as usual conditions.">
          Without project (baseline story)
        </label>
        <textarea id="withoutProject" rows="3"></textarea>
      </div>
    </div>

    <div class="field">
      <label for="projectObjectives" data-tooltip="Specific measurable objectives for the project.">
        Key objectives
      </label>
      <textarea id="projectObjectives" rows="3"></textarea>
    </div>

    <div class="field">
      <label for="projectActivities" data-tooltip="Main activities that deliver the change, for example extension, training, soil treatments.">
        Main activities
      </label>
      <textarea id="projectActivities" rows="3"></textarea>
    </div>

    <div class="field">
      <label for="stakeholderGroups" data-tooltip="Key stakeholder groups who gain, lose, or are involved.">
        Stakeholder groups
      </label>
      <textarea id="stakeholderGroups" rows="3"></textarea>
    </div>
  </div>
</section>

<!-- SETTINGS TAB -->
<section class="tab-panel" id="tab-settings" data-tab-panel="settings" aria-hidden="true">
  <div class="card">
    <h2>Time horizon and discounting</h2>
    <div class="row-4">
      <div class="field">
        <label for="startYear" data-tooltip="Calendar year when the analysis starts (year 0 cashflows).">
          Analysis start year
        </label>
        <input id="startYear" type="number" />
      </div>
      <div class="field">
        <label for="projectStartYear" data-tooltip="Year when the project or treatments begin on farm.">
          Project start year
        </label>
        <input id="projectStartYear" type="number" />
      </div>
      <div class="field">
        <label for="years" data-tooltip="Number of years over which costs and benefits are counted.">
          Years of analysis
        </label>
        <input id="years" type="number" min="1" />
      </div>
      <div class="field">
        <label for="systemType" data-tooltip="Single farm analysis or roll out across multiple farms.">
          System type
        </label>
        <select id="systemType">
          <option value="single">Single farm or system</option>
          <option value="multiple">Multiple farms or systems</option>
        </select>
      </div>
    </div>

    <div class="row-4">
      <div class="field">
        <label for="discBase" data-tooltip="Central discount rate used for present value calculations.">
          Discount rate (base, percent)
        </label>
        <input id="discBase" type="number" step="0.1" />
      </div>
      <div class="field">
        <label for="discLow" data-tooltip="Lower bound for discount rate used in the simulation.">
          Discount rate (low, percent)
        </label>
        <input id="discLow" type="number" step="0.1" />
      </div>
      <div class="field">
        <label for="discHigh" data-tooltip="Upper bound for discount rate used in the simulation.">
          Discount rate (high, percent)
        </label>
        <input id="discHigh" type="number" step="0.1" />
      </div>
      <div class="field">
        <label for="outputAssumptions" data-tooltip="Any general assumptions about prices, yields, or trial design.">
          Notes on general assumptions
        </label>
        <textarea id="outputAssumptions" rows="2"></textarea>
      </div>
    </div>

    <div class="row-4">
      <div class="field">
        <label for="mirrFinance" data-tooltip="Finance rate used to discount negative cashflows in MIRR.">
          MIRR finance rate (percent)
        </label>
        <input id="mirrFinance" type="number" step="0.1" />
      </div>
      <div class="field">
        <label for="mirrReinvest" data-tooltip="Reinvestment rate applied to positive cashflows in MIRR.">
          MIRR reinvestment rate (percent)
        </label>
        <input id="mirrReinvest" type="number" step="0.1" />
      </div>
      <div class="field"></div>
      <div class="field"></div>
    </div>

    <h3>Discount schedule by period</h3>
    <p class="small muted">
      Adjust the low, base, and high discount rates used in the simulation for each period.
    </p>
    <div class="table-scroll">
      <table class="summary-table">
        <thead>
          <tr>
            <th>Period</th>
            <th>Low (percent)</th>
            <th>Base (percent)</th>
            <th>High (percent)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>2025 to 2034</td>
            <td><input type="number" step="0.1" data-disc-period="0" data-scenario="low" /></td>
            <td><input type="number" step="0.1" data-disc-period="0" data-scenario="base" /></td>
            <td><input type="number" step="0.1" data-disc-period="0" data-scenario="high" /></td>
          </tr>
          <tr>
            <td>2035 to 2044</td>
            <td><input type="number" step="0.1" data-disc-period="1" data-scenario="low" /></td>
            <td><input type="number" step="0.1" data-disc-period="1" data-scenario="base" /></td>
            <td><input type="number" step="0.1" data-disc-period="1" data-scenario="high" /></td>
          </tr>
          <tr>
            <td>2045 to 2054</td>
            <td><input type="number" step="0.1" data-disc-period="2" data-scenario="low" /></td>
            <td><input type="number" step="0.1" data-disc-period="2" data-scenario="base" /></td>
            <td><input type="number" step="0.1" data-disc-period="2" data-scenario="high" /></td>
          </tr>
          <tr>
            <td>2055 to 2064</td>
            <td><input type="number" step="0.1" data-disc-period="3" data-scenario="low" /></td>
            <td><input type="number" step="0.1" data-disc-period="3" data-scenario="base" /></td>
            <td><input type="number" step="0.1" data-disc-period="3" data-scenario="high" /></td>
          </tr>
          <tr>
            <td>2065 to 2074</td>
            <td><input type="number" step="0.1" data-disc-period="4" data-scenario="low" /></td>
            <td><input type="number" step="0.1" data-disc-period="4" data-scenario="base" /></td>
            <td><input type="number" step="0.1" data-disc-period="4" data-scenario="high" /></td>
          </tr>
        </tbody>
      </table>
    </div>

    <h3>Adoption and risk settings</h3>
    <div class="row-3">
      <div class="field">
        <label for="adoptBase" data-tooltip="Central adoption multiplier applied to treatment areas.">
          Adoption (base, multiplier)
        </label>
        <input id="adoptBase" type="number" step="0.01" />
      </div>
      <div class="field">
        <label for="adoptLow" data-tooltip="Lower bound for adoption in simulation.">
          Adoption (low, multiplier)
        </label>
        <input id="adoptLow" type="number" step="0.01" />
      </div>
      <div class="field">
        <label for="adoptHigh" data-tooltip="Upper bound for adoption in simulation.">
          Adoption (high, multiplier)
        </label>
        <input id="adoptHigh" type="number" step="0.01" />
      </div>
    </div>

    <div class="row-3">
      <div class="field">
        <label for="riskBase" data-tooltip="Combined probability that the project does not deliver expected benefits.">
          Risk (base, probability)
        </label>
        <input id="riskBase" type="number" step="0.001" />
      </div>
      <div class="field">
        <label for="riskLow" data-tooltip="Lower bound for combined risk in simulation.">
          Risk (low, probability)
        </label>
        <input id="riskLow" type="number" step="0.001" />
      </div>
      <div class="field">
        <label for="riskHigh" data-tooltip="Upper bound for combined risk in simulation.">
          Risk (high, probability)
        </label>
        <input id="riskHigh" type="number" step="0.001" />
      </div>
    </div>

    <h3>Risk components</h3>
    <p class="small muted">
      Enter component risks so that the combined risk can be calculated. All values are probabilities between 0 and 1.
    </p>
    <div class="row-4">
      <div class="field">
        <label for="rTech" data-tooltip="Risk that the technical response is lower than expected.">
          Technical risk
        </label>
        <input id="rTech" type="number" step="0.001" />
      </div>
      <div class="field">
        <label for="rNonCoop" data-tooltip="Risk that non cooperation limits uptake or performance.">
          Non cooperation risk
        </label>
        <input id="rNonCoop" type="number" step="0.001" />
      </div>
      <div class="field">
        <label for="rSocio" data-tooltip="Risk that social or institutional factors reduce impacts.">
          Social and institutional risk
        </label>
        <input id="rSocio" type="number" step="0.001" />
      </div>
      <div class="field">
        <label for="rFin" data-tooltip="Risk linked to finance, cash flow, or credit constraints.">
          Finance risk
        </label>
        <input id="rFin" type="number" step="0.001" />
      </div>
    </div>
    <div class="row-4">
      <div class="field">
        <label for="rMan" data-tooltip="Risk related to management quality and implementation.">
          Management risk
        </label>
        <input id="rMan" type="number" step="0.001" />
      </div>
      <div class="field">
        <label>&nbsp;</label>
        <button id="calcCombinedRisk" class="btn">
          Calculate combined risk
        </button>
      </div>
      <div class="field">
        <label>&nbsp;</label>
        <div id="combinedRiskOut" class="small muted"></div>
      </div>
      <div class="field"></div>
    </div>
  </div>
</section>

<!-- OUTPUTS TAB -->
<section class="tab-panel" id="tab-outputs" data-tab-panel="outputs" aria-hidden="true">
  <div class="card">
    <h2>Outputs and unit values</h2>
    <p class="small muted">
      Define the key trial outputs, their units, and the value per unit. Treatment effects are entered per hectare in the Treatments tab.
    </p>
    <div class="actions-row">
      <button id="addOutput" class="btn primary">Add output metric</button>
    </div>
    <div id="outputsList" class="items-list"></div>
  </div>
</section>

<!-- TREATMENTS TAB -->
<section class="tab-panel" id="tab-treatments" data-tab-panel="treatments" aria-hidden="true">
  <div class="card">
    <h2>Treatments and per hectare effects</h2>
    <p class="small muted">
      Enter each treatment, its area, costs per hectare, and how it changes the outputs relative to the control. Control versus treatment status is used to build whole farm summaries.
    </p>
    <div class="actions-row">
      <button id="addTreatment" class="btn primary">Add treatment</button>
    </div>
    <div id="treatmentsList" class="items-list"></div>
  </div>

  <div class="card">
    <h3>Treatment ranking summary</h3>
    <p class="small muted">
      Treatments are ranked by benefit cost ratio using the base discount rate, adoption, and risk from the settings tab.
    </p>
    <div id="treatmentSummary" class="items-list"></div>
  </div>
</section>

<!-- BENEFITS TAB -->
<section class="tab-panel" id="tab-benefits" data-tab-panel="benefits" aria-hidden="true">
  <div class="card">
    <h2>Additional benefits beyond trial outputs</h2>
    <p class="small muted">
      Capture additional benefits such as cost savings, risk reduction, or long term soil improvements that are not directly included in the treatment output deltas.
    </p>
    <div class="actions-row">
      <button id="addBenefit" class="btn primary">Add benefit item</button>
    </div>
    <div id="benefitsList" class="items-list"></div>
  </div>
</section>

<!-- COSTS TAB -->
<section class="tab-panel" id="tab-costs" data-tab-panel="costs" aria-hidden="true">
  <div class="card">
    <h2>Other project costs</h2>
    <p class="small muted">
      Record project wide costs that are not already captured in the treatment costs, for example management or shared equipment. Depreciation settings apply only to capital items.
    </p>
    <div class="actions-row">
      <button id="addCost" class="btn primary">Add cost item</button>
    </div>
    <div id="costsList" class="items-list"></div>
  </div>
</section>

<!-- DATABASE TAB -->
<section class="tab-panel" id="tab-database" data-tab-panel="database" aria-hidden="true">
  <div class="card">
    <h2>Sources for outputs and treatments</h2>
    <p class="small muted">
      Tag the source used for each output value and treatment definition to support documentation and reporting.
    </p>
    <h3>Output metrics</h3>
    <div id="dbOutputs" class="items-list"></div>

    <h3>Treatments</h3>
    <div id="dbTreatments" class="items-list"></div>
  </div>
</section>

<!-- RESULTS TAB -->
<section class="tab-panel" id="tab-results" data-tab-panel="results" aria-hidden="true">
  <div class="card">
    <div class="results-header">
      <h2>Economic results for the whole project</h2>
      <div class="results-actions">
        <button id="recalc" class="btn primary" data-action="recalc">Recalculate results</button>
        <button id="exportCsv" class="btn">Export summary to CSV</button>
        <button id="exportPdf" class="btn">Print or save as PDF</button>
      </div>
    </div>

    <div class="metrics-grid">
      <div class="metric-card">
        <label>Total present value of benefits</label>
        <div id="pvBenefits" class="value">0</div>
      </div>
      <div class="metric-card">
        <label>Total present value of costs</label>
        <div id="pvCosts" class="value">0</div>
      </div>
      <div class="metric-card">
        <label>Net present value</label>
        <div id="npv" class="value">0</div>
      </div>
      <div class="metric-card">
        <label>Benefit cost ratio</label>
        <div id="bcr" class="value">n/a</div>
      </div>
      <div class="metric-card">
        <label>Internal rate of return</label>
        <div id="irr" class="value">n/a</div>
      </div>
      <div class="metric-card">
        <label>Modified internal rate of return</label>
        <div id="mirr" class="value">n/a</div>
      </div>
      <div class="metric-card">
        <label>Return on investment</label>
        <div id="roi" class="value">n/a</div>
      </div>
      <div class="metric-card">
        <label>Annual gross margin</label>
        <div id="grossMargin" class="value">0</div>
      </div>
      <div class="metric-card">
        <label>Gross profit margin</label>
        <div id="profitMargin" class="value">n/a</div>
      </div>
      <div class="metric-card">
        <label>Discounted payback (years)</label>
        <div id="payback" class="value">n/a</div>
      </div>
    </div>
  </div>

  <div class="card">
    <h3>Control versus treatment group comparison</h3>
    <p class="small muted">
      Control metrics are based on the selected control treatment. Treatment group metrics combine all non control treatments.
    </p>
    <div class="row-2 metrics-grid-compact">
      <div class="metric-block">
        <h4>Control group</h4>
        <div class="metric-row">
          <span>PV benefits</span><span id="pvBenefitsControl">n/a</span>
        </div>
        <div class="metric-row">
          <span>PV costs</span><span id="pvCostsControl">n/a</span>
        </div>
        <div class="metric-row">
          <span>NPV</span><span id="npvControl">n/a</span>
        </div>
        <div class="metric-row">
          <span>BCR</span><span id="bcrControl">n/a</span>
        </div>
        <div class="metric-row">
          <span>IRR</span><span id="irrControl">n/a</span>
        </div>
        <div class="metric-row">
          <span>ROI</span><span id="roiControl">n/a</span>
        </div>
        <div class="metric-row">
          <span>Payback</span><span id="paybackControl">n/a</span>
        </div>
        <div class="metric-row">
          <span>Annual gross margin</span><span id="gmControl">n/a</span>
        </div>
      </div>

      <div class="metric-block">
        <h4>Treatment group</h4>
        <div class="metric-row">
          <span>PV benefits</span><span id="pvBenefitsTreat">n/a</span>
        </div>
        <div class="metric-row">
          <span>PV costs</span><span id="pvCostsTreat">n/a</span>
        </div>
        <div class="metric-row">
          <span>NPV</span><span id="npvTreat">n/a</span>
        </div>
        <div class="metric-row">
          <span>BCR</span><span id="bcrTreat">n/a</span>
        </div>
        <div class="metric-row">
          <span>IRR</span><span id="irrTreat">n/a</span>
        </div>
        <div class="metric-row">
          <span>ROI</span><span id="roiTreat">n/a</span>
        </div>
        <div class="metric-row">
          <span>Payback</span><span id="paybackTreat">n/a</span>
        </div>
        <div class="metric-row">
          <span>Annual gross margin</span><span id="gmTreat">n/a</span>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <h3>Time profile of benefits and costs</h3>
    <p class="small muted">
      Present values below are calculated for different horizons using the base discount rate from the settings tab.
    </p>
    <div class="table-scroll">
      <table id="timeProjectionTable" class="summary-table">
        <thead>
          <tr>
            <th>Years from start</th>
            <th>PV benefits</th>
            <th>PV costs</th>
            <th>NPV</th>
            <th>BCR</th>
          </tr>
        </thead>
        <tbody>
          <!-- Filled by script -->
        </tbody>
      </table>
    </div>
    <div class="chart-row">
      <canvas id="timeNpvChart" width="720" height="280"></canvas>
    </div>
  </div>

  <div class="card">
    <h3>Depreciation summary for capital items</h3>
    <p class="small muted">
      This section summarises depreciation schedules for capital cost items where depreciation has been configured.
    </p>
    <div id="depSummary"></div>
  </div>

  <div class="card">
    <div class="results-footer-actions">
      <button id="exportCsvFoot" class="btn">Export summary to CSV</button>
      <button id="exportPdfFoot" class="btn">Print or save as PDF</button>
    </div>
  </div>
</section>

<!-- SIMULATION TAB -->
<section class="tab-panel" id="tab-simulation" data-tab-panel="simulation" aria-hidden="true">
  <div class="card">
    <h2>Monte Carlo simulation</h2>
    <p class="small muted">
      The simulation varies discount rates, adoption, and risk within the ranges set in the settings tab. You can also allow random variation in output values and costs.
    </p>

    <h3>Simulation settings</h3>
    <div class="row-4">
      <div class="field">
        <label for="simN" data-tooltip="Number of Monte Carlo runs. Larger values give smoother distributions.">
          Number of runs
        </label>
        <input id="simN" type="number" min="100" step="100" />
      </div>
      <div class="field">
        <label for="bcrMode" data-tooltip="Choose whether benefit cost ratios use all costs or only constrained costs in the denominator.">
          BCR denominator
        </label>
        <select id="bcrMode">
          <option value="all">All costs</option>
          <option value="constrained">Constrained costs only</option>
        </select>
      </div>
      <div class="field">
        <label for="targetBCR" data-tooltip="Target benefit cost ratio threshold for reporting probability.">
          Target BCR
        </label>
        <input id="targetBCR" type="number" step="0.1" />
      </div>
      <div class="field">
        <label for="randSeed" data-tooltip="Optional integer seed for the random number generator to support reproducible runs.">
          Random seed (optional)
        </label>
        <input id="randSeed" type="number" />
      </div>
    </div>

    <div class="row-3">
      <div class="field">
        <label for="simVarPct" data-tooltip="Maximum percentage variation applied to outputs and costs when variation is enabled.">
          Shock size for values (percent)
        </label>
        <input id="simVarPct" type="number" step="1" />
      </div>
      <div class="field">
        <label for="simVaryOutputs" data-tooltip="Allow random variation in output unit values.">
          Vary output values
        </label>
        <select id="simVaryOutputs">
          <option value="true">Yes</option>
          <option value="false">No</option>
        </select>
      </div>
      <div class="field">
        <label for="simVaryTreatCosts" data-tooltip="Allow random variation in treatment costs per hectare.">
          Vary treatment costs
        </label>
        <select id="simVaryTreatCosts">
          <option value="true">Yes</option>
          <option value="false">No</option>
        </select>
      </div>
    </div>

    <div class="row-3">
      <div class="field">
        <label for="simVaryInputCosts" data-tooltip="Allow random variation in project wide cost items.">
          Vary other project costs
        </label>
        <select id="simVaryInputCosts">
          <option value="true">Yes</option>
          <option value="false">No</option>
        </select>
      </div>
      <div class="field">
        <label>&nbsp;</label>
        <button id="runSim" class="btn primary" data-action="run-sim">
          Run simulation
        </button>
      </div>
      <div class="field">
        <label>&nbsp;</label>
        <div id="simStatus" class="small muted"></div>
      </div>
    </div>

    <p class="small muted">
      Current target BCR for probability reporting: <span id="simBcrTargetLabel">2</span>
    </p>
  </div>

  <div class="card">
    <h3>Simulation summary for net present value</h3>
    <div class="metrics-grid">
      <div class="metric-card">
        <label>Minimum NPV</label>
        <div id="simNpvMin" class="value">0</div>
      </div>
      <div class="metric-card">
        <label>Maximum NPV</label>
        <div id="simNpvMax" class="value">0</div>
      </div>
      <div class="metric-card">
        <label>Mean NPV</label>
        <div id="simNpvMean" class="value">0</div>
      </div>
      <div class="metric-card">
        <label>Median NPV</label>
        <div id="simNpvMedian" class="value">0</div>
      </div>
      <div class="metric-card">
        <label>Probability NPV greater than zero</label>
        <div id="simNpvProb" class="value">n/a</div>
      </div>
    </div>
    <div class="chart-row">
      <canvas id="histNpv" width="720" height="280"></canvas>
    </div>
  </div>

  <div class="card">
    <h3>Simulation summary for benefit cost ratio</h3>
    <div class="metrics-grid">
      <div class="metric-card">
        <label>Minimum BCR</label>
        <div id="simBcrMin" class="value">n/a</div>
      </div>
      <div class="metric-card">
        <label>Maximum BCR</label>
        <div id="simBcrMax" class="value">n/a</div>
      </div>
      <div class="metric-card">
        <label>Mean BCR</label>
        <div id="simBcrMean" class="value">n/a</div>
      </div>
      <div class="metric-card">
        <label>Median BCR</label>
        <div id="simBcrMedian" class="value">n/a</div>
      </div>
      <div class="metric-card">
        <label>Probability BCR greater than 1.0</label>
        <div id="simBcrProb1" class="value">n/a</div>
      </div>
      <div class="metric-card">
        <label>Probability BCR greater than target</label>
        <div id="simBcrProbTarget" class="value">n/a</div>
      </div>
    </div>
    <div class="chart-row">
      <canvas id="histBcr" width="720" height="280"></canvas>
    </div>
  </div>
</section>

<!-- EXCEL TAB -->
<section class="tab-panel" id="tab-excel" data-tab-panel="excel" aria-hidden="true">
  <div class="card">
    <h2>Excel import and export for faba bean trial</h2>
    <p>
      You can export a template workbook, edit the raw plot data in Excel, and then import it
      back into the tool. The tool reads the FabaBeanRaw sheet and recalibrates treatment yield
      uplifts and costs per hectare.
    </p>
    <p class="small muted">
      The SheetJS XLSX library is used in the browser. No data are sent to a server when you
      import or export workbooks.
    </p>

    <div class="row-2">
      <div class="field">
        <label>Template and sample workbooks</label>
        <div class="actions-row">
          <button id="downloadTemplate" class="btn primary">
            Download template with instructions
          </button>
          <button id="downloadSample" class="btn">
            Download sample workbook
          </button>
        </div>
      </div>
      <div class="field">
        <label>Import raw plot data</label>
        <div class="actions-row">
          <button id="parseExcel" class="btn primary">
            Select workbook and parse data
          </button>
          <button id="importExcel" class="btn">
            Apply parsed data to treatments
          </button>
        </div>
      </div>
    </div>

    <p class="small muted">
      After you apply Excel data, the default faba bean treatment list is replaced with
      treatments calculated from your raw dataset. You can then adjust areas, costs, and
      benefits as needed.
    </p>
  </div>
</section>

<!-- COPILOT TAB -->
<section class="tab-panel" id="tab-copilot" data-tab-panel="copilot" aria-hidden="true">
  <div class="card">
    <h2>Policy brief helper</h2>
    <p>
      This tab prepares a structured summary of the current scenario for use in a policy brief.
      You can copy the JSON payload and use it with an assistant tool to generate a short
      report for decision makers.
    </p>
    <p class="small muted">
      The JSON includes the project description, time settings, risk and adoption settings,
      base case economic results, and a ranked list of treatments. It also records whether a
      raw faba bean dataset is present.
    </p>

    <div class="actions-row">
      <button id="openCopilot" class="btn primary">
        Build JSON and copy to clipboard
      </button>
    </div>

    <div class="field">
      <label for="copilotPreview">
        JSON preview
      </label>
      <textarea id="copilotPreview" rows="16" spellcheck="false"></textarea>
    </div>
  </div>
</section>

  </main>

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <script src="app.js"></script>

</body>
</html>
